---
category:
    shop_by_price: true
    products:
        limit: {{theme_settings.categorypage_products_per_page}}
---
{{inject "categoryProductsPerPage" theme_settings.categorypage_products_per_page}}
{{#partial "head"}}
    {{#if pagination.category.previous}}
        <link rel="prev" href="{{pagination.category.previous}}">
    {{/if}}
    {{#if pagination.category.next}}
        <link rel="next" href="{{pagination.category.next}}">
    {{/if}}
{{/partial}}

{{#partial "page"}}

{{#if customer}}
         <div  class="customer-info-banner">
            <p class="customer-info-banner-item">{{customer.name}}</p>
            <p class="customer-info-banner-item">{{customer.email}}</p>
            <p class="customer-info-banner-item">{{customer.phone}}</p> 
        </div>  
{{/if}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
{{#if category.image}}
    {{> components/common/responsive-img
        image=category.image
        fallback_size=theme_settings.zoom_size
        lazyload=theme_settings.lazyload_mode
        class="category-header-image"
    }}
{{/if}}
{{#unless theme_settings.hide_category_page_heading }}
    <h1 class="page-heading">{{category.name}}</h1>
    {{{region name="category_below_header"}}}
{{/unless}}

<button class="add-all-to-cart-button">Add All to Cart</button>

<button class="delete-all-from-cart-button">Delete all from cart</button>


{{{category.description}}}
<div class="page">
    {{#if category.faceted_search_enabled}}
        <aside class="page-sidebar" id="faceted-search-container">
            {{> components/category/sidebar}}
        </aside>
    {{else if category.subcategories}}
        <aside class="page-sidebar" id="faceted-search-container">
            {{> components/category/sidebar}}
        </aside>
    {{else if category.shop_by_price}}
        {{#if theme_settings.shop_by_price_visibility}}
             <aside class="page-sidebar" id="faceted-search-container">
                {{> components/category/sidebar}}
            </aside>
        {{/if}}
    {{/if}}

    <div class="page-content" id="product-listing-container">
        {{> components/category/product-listing}}
        {{{region name="category_below_content"}}}
    </div>
</div>

{{/partial}}
{{> layout/base}}



<script>
   document.addEventListener('DOMContentLoaded', function () {
  const addButton = document.querySelector('.add-all-to-cart-button');

  if (addButton) {
    addButton.addEventListener('click', function () {
      const products = document.querySelectorAll('.product'); // Adjust selector to target your product elements
      const productIds = [];

      products.forEach(function (product) {
        const productId = product.getAttribute('data-product-id'); // Adjust attribute name based on your product data
        productIds.push(productId);
      });

      if (productIds.length > 0) {
        addProductsToCart(productIds, function () {
          displayPopup('All items added to cart');
        });
      }
    });
  }
});

function addProductsToCart(productIds, callback) {
  const cartUrl = '/cart.php?action=add';
  const formData = new FormData();

  productIds.forEach((productId) => {
    formData.append('product_id[]', productId);
    formData.append('qty[]', '1'); // You can adjust the quantity as needed
  });

  fetch(cartUrl, {
    method: 'POST',
    body: formData
  })
    .then(response => response.text())
    .then(data => {
      // Handle the response data if needed
      callback();
    })
    .catch(error => {
      console.error('Error adding products to cart:', error);
    });
}

function displayPopup(message) {
  // Implement the logic to display a popup message here
  // This could be a custom implementation or using a third-party library
  alert(message); // For a simple popup, but you might want to use a more sophisticated approach
}


</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const deleteButton = document.getElementById('delete-cart-button');

      deleteButton.addEventListener('click', function () {
        const storeHash = 'your_store_hash';
        const cartId = 'your_cart_id';
        const authToken = 'your_auth_token';

        const url = `https://api.bigcommerce.com/stores/${storeHash}/v3/carts/${cartId}`;

        const options = {
          method: 'DELETE',
          headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
            'X-Auth-Token': authToken
          }
        };

        fetch(url, options)
          .then(res => res.json())
          .then(json => console.log(json))
          .catch(err => console.error('error:', err));
      });
    });
  </script>
