---
category:
shop_by_price: true
products:
limit: {{theme_settings.categorypage_products_per_page}}
---
{{inject "categoryProductsPerPage" theme_settings.categorypage_products_per_page}}
{{#partial "head"}}
{{#if pagination.category.previous}}
<link rel="prev" href="{{pagination.category.previous}}">
{{/if}}
{{#if pagination.category.next}}
<link rel="next" href="{{pagination.category.next}}">
{{/if}}
{{/partial}}

{{#partial "page"}}

{{#if customer}}
<div class="customer-info-banner">
  <p class="customer-info-banner-item">{{customer.name}}</p>
  <p class="customer-info-banner-item">{{customer.email}}</p>
  <p class="customer-info-banner-item">{{customer.phone}}</p>
</div>
{{/if}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
{{#if category.image}}
{{> components/common/responsive-img
image=category.image
fallback_size=theme_settings.zoom_size
lazyload=theme_settings.lazyload_mode
class="category-header-image"
}}
{{/if}}
{{#unless theme_settings.hide_category_page_heading }}
<h1 class="page-heading">{{category.name}}</h1>
{{{region name="category_below_header"}}}
{{/unless}}


<!-- buttons to add all items to cart or delete all items from cart -->
<div class="all-cart-buttons">

  <button type="button" id="add-all-cart" class="add-all-to-cart-button all-cart-button">Add All to Cart</button>

  <button type="button" class="delete-all-cart-button all-cart-button">Delete all from cart</button>
</div>


{{{category.description}}}
<div class="page">
  {{#if category.faceted_search_enabled}}
  <aside class="page-sidebar" id="faceted-search-container">
    {{> components/category/sidebar}}
  </aside>
  {{else if category.subcategories}}
  <aside class="page-sidebar" id="faceted-search-container">
    {{> components/category/sidebar}}
  </aside>
  {{else if category.shop_by_price}}
  {{#if theme_settings.shop_by_price_visibility}}
  <aside class="page-sidebar" id="faceted-search-container">
    {{> components/category/sidebar}}
  </aside>
  {{/if}}
  {{/if}}

  <div class="page-content" id="product-listing-container">
    {{> components/category/product-listing}}
    {{{region name="category_below_content"}}}
  </div>
</div>

{{/partial}}
{{> layout/base}}


<!-- <script>
  const addToCartForm = Array.from(document.getElementsByTagName('form')).find(item => item.action.value === 'add' && item.action.name === 'action');

  if (typeof addToCartForm === 'object' && addToCartForm.hasOwnProperty('product_id')) {
    return addToCartForm.product_id.value;}
</script> -->

<!-- <script src="https://code.jquery.com/jquery-{version}.min.js">$("button#add-all-cart").click(function() {
  const addToCartForms = Array.from(document.getElementsByTagName('form')).filter(item => 
      item.action.value === 'add' && item.action.name === 'action' &&
      typeof item.product_id === 'object' && item.product_id.hasOwnProperty('value')
  );

  const asyncRequests = [];

  for (const form of addToCartForms) {
      const productId = form.product_id.value;
      asyncRequests.push(
          $.get("/cart.php?action=add&product_id=" + productId)
          .done(function(data, status, xhr) {
              console.log('Item ' + productId + ' complete with status ' + status);
          })
      );
  }

  $.when.apply($, asyncRequests)
  .fail(function(xhr, status, error) {
      console.log('Oh noes, error with status ' + status + ' and error: ');
      console.error(error);
  })
  .always(function() {
      // Go to cart
      window.location = "/cart.php";
  });
});
</script> -->

<script src="https://code.jquery.com/jquery-{version}.min.js">
  // when #add-all-cart is clicked...
  $("button#add-all-cart").click(function() {
   
    // add product id 123
      return $.get("/cart.php?action=add&product_id=112")
    .done(function(data, status, xhr) {
      console.log('first item complete with status ' + status);
    })
    .then(function() {
      // add product id 456
      return $.get("/cart.php?action=add&product_id=112");
    })
    .done(function(data, status, xhr) {
      console.log('second item complete with status ' + status);
    })
    // chain more async GET requests using .then & .done
    .fail(function(xhr, status, error) {
      console.log('oh noes, error with status ' + status + ' and error: ');
      console.error(error);
      return xhr.done();
    })
    .always(function() {
      // go to cart
      return window.location = "/cart.php";
    });
   
  });
  </script>